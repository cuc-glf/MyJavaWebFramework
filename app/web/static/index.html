<html>
<head>
	<title>websocket test</title>
	<script type="text/javascript" src="js/stomp.min.js"></script>
</head>
<body>
	<script type="text/javascript">
		var RAW_WEBSOCKET = 0;
		var STOMP_OVER_WEBSOCKET = 1;
		var OPERATION = STOMP_OVER_WEBSOCKET;

		switch (OPERATION) {
			case RAW_WEBSOCKET:
				testRawWebsocket();
				break;
			case STOMP_OVER_WEBSOCKET:
				testSTOMPOverWebsocket();
				break;
		}

		function testRawWebsocket() {
			var socket = new WebSocket('ws://127.0.0.1:8080/myHandler');
			socket.onopen = function(event) {
				var count = 0;
				var runnableId = setInterval(function() {
					socket.send('I am the client! This is message #' + count++);
				}, 5000);

				socket.onmessage = function(event) {
					console.log('Client received a message', event);
				};

				socket.onclose = function(event) {
	    			console.log('Client notified socket has closed',event);
	    			clearInterval(runnableId);
				}
			}
		}

		function testSTOMPOverWebsocket() {
			var socket = new WebSocket('ws://127.0.0.1:8080/portfolio');
			var stompClient = Stomp.over(socket);
			stompClient.connect({}, function(frame) {
				console.log('stomp connected, frame: ' + frame);
				var subscription = stompClient.subscribe('/topic/greeting', function(message) {
					console.log('message on /queue/test received: ' + message);
				});
				stompClient.send('/app/greeting', {}, '1');
			});
		}

	</script>
</body>
</html>